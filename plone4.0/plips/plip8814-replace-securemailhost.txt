PLIP 8814: Replace SecureMailHost with a standard Zope mailhost
==============================================

This plip is ready for review.

Plip ticket: https://dev.plone.org/plone/ticket/8814

This PLIP requires changes that now live in the Zope 2.12 branch.

Plone no longer depends on SecureMailHost, though it now monkey
patches some SecureMailHost functionality into the Zope MailHost with
deprecation warnings.  The plone.app.upgrade package does depend on
SecureMailHost in order to migrate settings from existing SecureMailHost
instances.

Branches Made
-------------------

https://svn.plone.org/svn/plone/Plone/branches/plip8814-mailhost
https://svn.plone.org/svn/plone/plone.app.contentrules/branches/plip8814-mailhost
https://svn.plone.org/svn/plone/plone.app.upgrade/branches/plip8814-mailhost

http://thread.gmane.org/gmane.comp.web.zope.devel/21366

Summary of changes
------------------

- Use MailHost instead of SecureMailHost on install

- Added migration of existing SecureMailHost instances to plone.app.upgrade

- Remove references to secureSend and other SecureMailHost API calls
  from Products.CMFPlone and plone.app.contentrules

- Fixed inconsistent tests in plone.app.controlpanel

- Add backwards compatibility patches to ensure 3rd party code that
  uses secureSend, validateSingleNormalizedEmailAddress,
  validateSingleEmailAddress, or validateEmailAddresses continues to
  work but produces deprecation warnings.

- Add deprecated import of EMAIL_RE and EMAIL_CUTOFF_RE, since those
  are essentially public APIs of SecureMailHost.

- Committed fixes to Products.MailHost on Zope 2.12 branch.  The
  following issues were fixed:

 - Products.MailHost.MailHost makes it difficult to set a charset for
   the message

  - Products.MailHost.MailHost does not handle unicode messages.

  - Products.MailHost.MailHost treats message bodies with a ':' in them
    as headers!!

  - Manage form treats None as a string.

Tests
------

- New MailHost functionality in Zope2 has extensive tests.

- Some test changes were needed to correctly use MailHost for encoded emails

- Tests for the migration and portal setup were added.

- There are no tests for the BBB patches for SecureMailHost
  functionality, but they have been manually tested.

- The Zope2 MailHost changes cause one cosmetic test failure in
  CMFDefault, due to its tests expecting automatic base64 encoding
  from python's email module, whereas the MailHost changes use
  quoted-printable by default.

Needed documentation changes
----------------------------

- Document method deprecations: "secureSend" should no longer be used,
   "send" should be used instead.  The parameters are slightly
   different, but using "send" should be straightforward.


Backwards compatibility
-----------------------

No known issues.  Email encoded utf-8 will be transport encoded
Quoted-Printable instead of Base64 as a result of MailHost changes.


Credits
-------

Hanno Schlichting
Alec Mitchell
