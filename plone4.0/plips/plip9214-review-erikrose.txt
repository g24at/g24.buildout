PLIP 9214 - Review - Erik Rose
==============================

- I would feel better about the addition of this feature into the core if it
  were done with more inversion of control and fewer branches added into already
  complicated scripts and templates. For example, login_form_validate.vpy and
  its associated machinery could be refactored into Zope 3 views, and the
  email-based login script could be either a subclass of that view or an
  alternate top-level implementation which calls helper methods from it.
  Non-email-based login would work the same way, calling the same helper
  methods. For example, instead of this...

    if mt.getMemberById(user_name) is None:
    Ê Ê if email_login:
    Ê Ê Ê Ê state.setError(ac_name, _(u'Email address not known.'), 'email_address_not_known')
    Ê Ê else:
    Ê Ê Ê Ê state.setError(ac_name, _(u'Login name not found.'), 'login_name_not_found')

    ...we could do something like this...

    if mt.getMemberById(user_name) is None:
        state.setError(ac_name, view/login_name_not_known_message, view/login_name_not_known_id)
    
  ...making the flow of the script easier to follow and leaving room for
  future login customizations without bloating the top-level control script
  or even modifying Plone at all. We might even be able to avoid creating a
  new view by having the one and only view delegate to an adapter which
  provides all the email/loginname differentiating behavior: when email
  login is in effect, one adapter is registered; when login name login is in
  effect, a different one is. The adapter would return error messages, look
  up users by whatever key is in effect, etc.

- Just a note on one of your future ideas: the local part of an email address
  is actually case-sensitive, according to RFC 5322 (though such sensitivity is
  discouraged by RFC 5321). We could still make the rest of it case-insensitive,
  though.

- I can't find anything else to complain about. I don't think it'll even break
  WebServerAuth. Nice work. :-)


Update, 10/6/2009
=================

Nothing in my original review has changed for the worse. Still +1 for merging.