PLIP 9311: Clean up user related actions UI
===========================================

PLIP ticket: https://dev.plone.org/plone/ticket/9311

Review #2 by Rob Gietema (rob@fourdigits.nl, Rob|4D on irc)

The PLIP was reviewed on Mac OS X 10.5.8 using python 2.6.1 and Firefox 3.5.2.


Review steps
------------

- Run buildout using the plip9311-plone-app-users.cfg file.

- Run tests for Products.CMFPlone.

- Visual review of the code changes in Products.CMFPlone.

- Run tests for plone.app.layout.

- Visual review of the code changes in plone.app.layout.

- Run tests for plone.app.users.

- Visual review of the code changes in plone.app.users.

- Started instance, created site, browse through user settings screens as admin.

- Created a normal member user and edited user settings.


Notes and observations
----------------------

- Products.CMFPlone tests finished with errors: "No module named form". It seems
  form.py was renamed to account.py but the imports of all the py files in
  the browser folder where still referring to form.py. After changing all the
  imports these tests passed.

- After these changes the Products.CMFPlone tests finished with 7 failures and
  4 error. They all seem related to the changed made.

- Code changes to Products.CMFPlone all look sane. All 'old' personalisation
  code is removed but the tests are not updated yet.

- plone.app.layout tests finished with 1 error which is related to the
  MembershipTool.

- Code changes to plone.app.layout all look sane.

- plone.app.users tests finished with 2 failures.

- account-tabs.pt seems to be unused and should be removed.

- The setting "Username listed in searches" is removed from the personal
  preferences but is still available in the membershiptool. Why is it removed?

- Allow editing of shortnames is added as a preference.

- The "tabs" are generated in all 3 edit screens. Using a macro for this is a
  better solution so the same code doesn't have to be in 3 different templates.

- The only property from the membershiptool which isn't editable is
  "portal_skin". Is this used? If it is why isn't it editable? If it isn't
  shouldn't it be removed?

- Saving the Personal preferences raises an error at Wysiwyg editor no matter
  what value is selected.

- The "Home page" field doesn't have a "isURL" validator.

- Changing the password raises an error: "AttributeError: getUserid".

- cmf.SetOwnProperties and cmf.SetOwnPassword are checked in the browserviews
  but not in portal actions and personal_bar. Removing one of these permissions
  from a user leads to the "Insufficient Privileges" page. A better solution
  would be to not show the specific actions at all if they don't have permission
  to use them.

- All the issues mentioned in "To do" and "Further ideas" are valid and should
  be implemented before merging.


Conclusion
----------

Looking good so far but needs so more work to finalize.


Second review
=============

Notes and observations
----------------------

- There are still some tests failing for Products.CMFPlone. As far as I can tell
  they are related to the changes made.

- It seems the tests in Products.CMFPlone are still not updated to match the new
  code.

- Tests in plone.app.layout don't fail anymore.

- Tests in plone.app.users still fail.

- account-tabs.pt is removed and tabs are fixed.

- "Username listed in searches" is put back.

- Personal Preferences error when saving is fixed.

- URL validator for homepage is added.

- I can't get the change_password view to work, I'm getting an error right away.

- It seems the profile view is not used anymore but the templates and view
  classes are still there.


Conclusion
----------
A lot of improvements have been made since the initial implementation. This is a
big improvement over the current UI however I'm a bit worried about the failing
tests and the change_password form not working for me. I'm +0 on merging.
