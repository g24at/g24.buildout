PLIP 8802: Move our upgrade / migration infrastructure to GenericSetup
======================================================================

This plip is ready for review.

Plip ticket: https://dev.plone.org/plone/ticket/8802


Branches
--------

This work was completed on the main Plone 4.0 branches alongside my other work
on the base of Plone 4.  In particular see:

 * http://dev.plone.org/plone/changeset/27411/Plone/branches/davisagli-4.0-trunk-backports/Products/CMFPlone/MigrationTool.py
 * http://dev.plone.org/plone/changeset/28286
 * entire history of http://dev.plone.org/plone/browser/plone.app.upgrade/branches/1.0


Summary of changes
------------------

- The Plone migration tool no longer keeps its own registry of available
  migration endpoints and steps.  Instead, the GenericSetup upgrade steps
  feature is used, and the migration tool has become a wrapper which calls
  the GenericSetup API to get the current version and do actual updates.

- The actual upgrade code, profiles, and tests have been moved to the new
  plone.app.upgrade package, in order to facilitate *not* loading additional
  dependencies that may be needed for upgrades, once the upgrade is complete.

- Most upgrade steps are now registered with ZCML, using the
  genericsetup:upgradeStep directive.

- Upgrade steps now log using the Python logging framework rather than passing
  around a list of output strings.

- Upgrade steps from anything prior to Plone 2.5 final have been removed, since
  that was the first version of Plone to include the setup tool, which is now
  required for performing upgrades.  It is assumed that users requiring a
  migration from older versions of Plone will perform a two-step migration by
  first upgrading to Plone 3.


To do
-----

* This branch of plone.app.upgrade was backported following a lot of work by
  Hanno on trunk.  So I need to double-check that there aren't any more
  upgrade steps which had been removed due to being irrelevant on trunk, that
  we actually do want now.


Tests
-----

The most directly relevant tests are the migration tool tests and the
plone.app.upgrade tests::

  bin/test -s Products.CMFPlone -m testMigrationTool
  bin/test -s plone.app.upgrade


Needed documentation changes
----------------------------

plone.org doesn't seem to include any documentation of GenericSetup's
upgrade step feature, as it relates to Plone itself or Plone addons.
This should probably be added.

http://plone.org/documentation/tutorial/genericsetup/the-future/ does
mention a feature like upgrade steps, but is out of date.


i18n
----

These changes generally affect a ZMI interface which was not
internationalized before and still is not.


Backwards compatibility
-----------------------

Several unused methods of the migration tool were removed.

Any third-party code importing migration methods from the old location will
need to be updated.


Credits
-------

David Glick
Hanno Schlichting
