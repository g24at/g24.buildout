diff -uiwBrN fresh_plone_40/actionicons.xml migrated_from_25/actionicons.xml
--- fresh_plone_40/actionicons.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/actionicons.xml	2009-09-06 00:25:28.000000000 +0200
@@ -1,11 +1,2 @@
 <?xml version="1.0"?>
-<action-icons>
-  <action-icon category="controlpanel" action_id="kupu"
-  title="Kupu visual editor" priority="0"
-  icon_expr="kupuimages/kupu_icon.gif" />
-  <action-icon category="controlpanel" action_id="versioning"
-  title="Versioning" priority="0" icon_expr="versioning.gif" />
-  <action-icon category="controlpanel" action_id="placefulworkflow"
-  title="Placeful Workflow" priority="0"
-  icon_expr="placefulworkflow_icon.png" />
-</action-icons>
+<action-icons></action-icons>
diff -uiwBrN fresh_plone_40/actions.xml migrated_from_25/actions.xml
--- fresh_plone_40/actions.xml	2009-09-06 00:12:28.000000000 +0200
+++ migrated_from_25/actions.xml	2009-09-06 00:25:28.000000000 +0200
@@ -10,8 +10,7 @@
       <property name="title" i18n:translate="">RSS feed</property>
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">string:$object_url/RSS</property>
-      <property name="icon_expr">
-      string:$portal_url/rss.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr">
       python:portal.portal_syndication.isSyndicationAllowed(object)</property>
       <property name="permissions">
@@ -26,8 +25,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:$object_url/sendto_form</property>
-      <property name="icon_expr">
-      string:$portal_url/mail_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr"></property>
       <property name="permissions">
         <element value="Allow sendto" />
@@ -42,8 +40,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:javascript:this.print();</property>
-      <property name="icon_expr">
-      string:$portal_url/print_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr"></property>
       <property name="permissions">
         <element value="View" />
@@ -58,10 +55,8 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:javascript:toggleFullScreenMode();</property>
-      <property name="icon_expr">
-      string:$portal_url/fullscreenexpand_icon.gif</property>
-      <property name="available_expr">python:member is not
-      None</property>
+      <property name="icon_expr"></property>
+      <property name="available_expr">member</property>
       <property name="permissions">
         <element value="View" />
       </property>
@@ -75,8 +70,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:$object_url/external_edit</property>
-      <property name="icon_expr">
-      string:$portal_url/extedit_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr">
       object/externalEditorEnabled</property>
       <property name="permissions">
@@ -154,8 +148,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:folder_copy:method</property>
-      <property name="icon_expr">
-      string:$portal_url/copy_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr"></property>
       <property name="permissions">
         <element value="Copy or Move" />
@@ -167,8 +160,7 @@
       <property name="title" i18n:translate="">Cut</property>
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">string:folder_cut:method</property>
-      <property name="icon_expr">
-      string:$portal_url/cut_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr">
       python:checkPermission("Delete objects", object)</property>
       <property name="permissions">
@@ -197,8 +189,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:folder_paste:method</property>
-      <property name="icon_expr">
-      string:$portal_url/paste_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr">
       folder/cb_dataValid</property>
       <property name="permissions">
@@ -213,8 +204,7 @@
       <property name="description" i18n:translate=""></property>
       <property name="url_expr">
       string:folder_delete:method</property>
-      <property name="icon_expr">
-      string:$portal_url/delete_icon.gif</property>
+      <property name="icon_expr"></property>
       <property name="available_expr"></property>
       <property name="permissions">
         <element value="Delete objects" />
@@ -419,8 +409,7 @@
       <property name="url_expr">
       string:${globals_view/navigationRootUrl}/login_form</property>
       <property name="icon_expr"></property>
-      <property name="available_expr">python:member is
-      None</property>
+      <property name="available_expr">not: member</property>
       <property name="permissions">
         <element value="View" />
       </property>
@@ -433,8 +422,7 @@
       <property name="url_expr">
       string:${globals_view/navigationRootUrl}/join_form</property>
       <property name="icon_expr"></property>
-      <property name="available_expr">python:member is
-      None</property>
+      <property name="available_expr">not:member</property>
       <property name="permissions">
         <element value="Add portal member" />
       </property>
@@ -447,8 +435,7 @@
       <property name="url_expr">
       string:${globals_view/navigationRootUrl}/undo_form</property>
       <property name="icon_expr"></property>
-      <property name="available_expr">python:member is not
-      None</property>
+      <property name="available_expr">member</property>
       <property name="permissions">
         <element value="List undoable changes" />
       </property>
@@ -462,8 +449,7 @@
       <property name="url_expr">
       string:${globals_view/navigationRootUrl}/logout</property>
       <property name="icon_expr"></property>
-      <property name="available_expr">python:member is not
-      None</property>
+      <property name="available_expr">member</property>
       <property name="permissions">
         <element value="View" />
       </property>
diff -uiwBrN fresh_plone_40/archetype_tool.xml migrated_from_25/archetype_tool.xml
--- fresh_plone_40/archetype_tool.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/archetype_tool.xml	2009-09-06 00:25:28.000000000 +0200
@@ -61,9 +61,6 @@
     <type portal_type="ATSortCriterion">
       <catalog value="portal_catalog" />
     </type>
-    <type portal_type="ATRelativePathCriterion">
-      <catalog value="portal_catalog" />
-    </type>
     <type portal_type="ATPortalTypeCriterion">
       <catalog value="portal_catalog" />
     </type>
diff -uiwBrN fresh_plone_40/componentregistry.xml migrated_from_25/componentregistry.xml
--- fresh_plone_40/componentregistry.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/componentregistry.xml	2009-09-06 00:25:28.000000000 +0200
@@ -22,10 +22,8 @@
     object="portal_diff" />
     <utility interface="Products.CMFPlacefulWorkflow.interfaces.portal_placeful_workflow.IPlacefulWorkflowTool"
     object="portal_placeful_workflow" />
-    <utility interface="Products.CMFPlone.interfaces.interface.IInterfaceTool"
-    object="portal_interface" />
-    <utility interface="Products.CMFPlone.interfaces.migration.IMigrationTool"
-    object="portal_migration" />
+    <utility interface="Products.CMFPlone.interfaces.basetool.IPloneTool"
+    object="plone_utils" />
     <utility interface="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
     object="" />
     <utility interface="Products.CMFUid.interfaces.IUniqueIdAnnotationManagement"
@@ -38,6 +36,8 @@
     object="mimetypes_registry" />
     <utility interface="Products.PortalTransforms.interfaces.IPortalTransformsTool"
     object="portal_transforms" />
+    <utility interface="Products.ResourceRegistries.interfaces.registries.IKSSRegistry"
+    object="portal_kss" />
     <utility interface="five.customerize.interfaces.IViewTemplateContainer"
     object="portal_view_customizations" />
     <utility interface="plone.app.i18n.locales.interfaces.IContentLanguages"
diff -uiwBrN fresh_plone_40/contenttyperegistry.xml migrated_from_25/contenttyperegistry.xml
--- fresh_plone_40/contenttyperegistry.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/contenttyperegistry.xml	2009-09-06 00:25:28.000000000 +0200
diff -uiwBrN fresh_plone_40/controlpanel.xml migrated_from_25/controlpanel.xml
--- fresh_plone_40/controlpanel.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/controlpanel.xml	2009-09-06 00:25:28.000000000 +0200
@@ -1,155 +1,155 @@
 <?xml version="1.0"?>
 <object name="portal_controlpanel"
 meta_type="Plone Control Panel Tool">
-  <configlet title="Add-on Products" action_id="QuickInstaller"
+  <configlet title="Add/Remove Products" action_id="QuickInstaller"
   appId="QuickInstaller" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/product_icon.png"
+  icon_expr="string:$portal_url/product_icon.gif"
   url_expr="string:${portal_url}/prefs_install_products_form"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Site" action_id="PloneReconfig" appId="Plone"
-  category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/logoIcon.png"
-  url_expr="string:${portal_url}/@@site-controlpanel"
-  visible="True">
-    <permission>Manage portal</permission>
-  </configlet>
   <configlet title="Users and Groups" action_id="UsersGroups"
   appId="UsersGroups" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/group.png"
-  url_expr="string:${portal_url}/@@usergroup-userprefs"
+  icon_expr="string:$portal_url/group.gif"
+  url_expr="string:${portal_url}/prefs_users_overview"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
   <configlet title="Users and Groups" action_id="UsersGroups2"
   appId="UsersGroups" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/group.png"
-  url_expr="string:${portal_url}/@@usergroup-groupprefs"
+  icon_expr="string:$portal_url/group.gif"
+  url_expr="string:${portal_url}/prefs_groups_overview"
   visible="False">
     <permission>Manage portal</permission>
   </configlet>
   <configlet title="Personal Preferences" action_id="MemberPrefs"
   appId="Plone" category="Member" condition_expr=""
-  icon_expr="string:$portal_url/user.png"
+  icon_expr="string:$portal_url/user.gif"
   url_expr="string:${portal_url}/personalize_form" visible="True">
     <permission>Set own properties</permission>
   </configlet>
   <configlet title="Change Password" action_id="MemberPassword"
   appId="Plone" category="Member"
   condition_expr="python:member.canPasswordSet()"
-  icon_expr="string:$portal_url/lock_icon.png"
+  icon_expr="string:$portal_url/lock_icon.gif"
   url_expr="string:${portal_url}/password_form" visible="True">
     <permission>Set own password</permission>
   </configlet>
-  <configlet title="Mail" action_id="MailHost" appId="MailHost"
-  category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/mail_icon.png"
-  url_expr="string:${portal_url}/@@mail-controlpanel"
+  <configlet title="Error Log" action_id="errorLog"
+  appId="ErrorLog" category="Plone" condition_expr=""
+  icon_expr="string:$portal_url/error_log_icon.gif"
+  url_expr="string:${portal_url}/prefs_error_log_form"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Themes" action_id="PortalSkin"
-  appId="PortalSkin" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/skins_icon.png"
-  url_expr="string:${portal_url}/@@skins-controlpanel"
+  <configlet title="Zope Management Interface" action_id="ZMI"
+  appId="ZMI" category="Plone" condition_expr=""
+  icon_expr="string:$portal_url/zope_icon.gif"
+  url_expr="string:${portal_url}/manage_main" visible="True">
+    <permission>Manage portal</permission>
+  </configlet>
+  <configlet title="Navigation" action_id="NavigationSettings"
+  appId="Plone" category="Plone" condition_expr=""
+  icon_expr="string:$portal_url/navigation_icon.gif"
+  url_expr="string:${portal_url}/prefs_navigation_form"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Errors" action_id="errorLog" appId="ErrorLog"
-  category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/error_log_icon.png"
-  url_expr="string:${portal_url}/prefs_error_log_form"
+  <configlet title="Kupu visual editor" action_id="kupu"
+  appId="Kupu" category="Products" condition_expr=""
+  icon_expr="string:$portal_url/kupuimages/kupu_icon.gif"
+  url_expr="string:${portal_url}/kupu_library_tool/kupu_config"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Types" action_id="TypesSettings"
-  appId="TypesSettings" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/document_icon.png"
-  url_expr="string:${portal_url}/@@types-controlpanel"
+  <configlet title="Collection" action_id="portal_atct"
+  appId="ATContentTypes" category="Plone" condition_expr=""
+  icon_expr="string:$portal_url/topic_icon.gif"
+  url_expr="string:${portal_url}/portal_atct/atct_manageTopicIndex"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
   <configlet title="Markup" action_id="MarkupSettings"
   appId="MarkupSettings" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/edit.png"
-  url_expr="string:${portal_url}/@@markup-controlpanel"
+  icon_expr="string:${portal_url}/edit.png"
+  url_expr="string:${portal_url}/@@language-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Security" action_id="SecuritySettings"
-  appId="SecuritySettings" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/lock_icon.png"
-  url_expr="string:${portal_url}/@@security-controlpanel"
+  <configlet title="Calendar" action_id="CalendarSettings"
+  appId="Plone" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/event_icon.png"
+  url_expr="string:${portal_url}/@@calendar-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Zope Management Interface" action_id="ZMI"
-  appId="ZMI" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/zope_icon.png"
-  url_expr="string:${portal_url}/manage_main" visible="True">
-    <permission>Manage portal</permission>
-  </configlet>
   <configlet title="Search" action_id="SearchSettings"
   appId="Plone" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/search_icon.png"
+  icon_expr="string:${portal_url}/search_icon.png"
   url_expr="string:${portal_url}/@@search-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Navigation" action_id="NavigationSettings"
-  appId="Plone" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/navigation_icon.png"
-  url_expr="string:${portal_url}/prefs_navigation_form"
+  <configlet title="Mail" action_id="MailHost" appId="MailHost"
+  category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/mail_icon.png"
+  url_expr="string:${portal_url}/@@mail-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Language" action_id="PloneLanguageTool"
-  appId="PloneLanguageTool" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/flag-plone.png"
-  url_expr="string:${portal_url}/@@language-controlpanel"
+  <configlet title="Maintenance" action_id="Maintenance"
+  appId="Plone" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/maintenance_icon.png"
+  url_expr="string:${portal_url}/@@maintenance-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Collections" action_id="portal_atct"
-  appId="ATContentTypes" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/topic_icon.png"
-  url_expr="string:${portal_url}/portal_atct/atct_manageTopicIndex"
+  <configlet title="Themes" action_id="PortalSkin"
+  appId="PortalSkin" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/skins_icon.png"
+  url_expr="string:${portal_url}/@@skins-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Calendar" action_id="CalendarSettings"
-  appId="Plone" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/event_icon.png"
-  url_expr="string:${portal_url}/@@calendar-controlpanel"
+  <configlet title="Site" action_id="PloneReconfig" appId="Plone"
+  category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/logoIcon.png"
+  url_expr="string:${portal_url}/@@site-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
   <configlet title="HTML Filtering" action_id="HtmlFilter"
   appId="HtmlFilter" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/htmlfilter_icon.png"
+  icon_expr="string:${portal_url}/htmlfilter_icon.png"
   url_expr="string:${portal_url}/@@filter-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
-  <configlet title="Maintenance" action_id="Maintenance"
-  appId="Plone" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/maintenance_icon.png"
-  url_expr="string:${portal_url}/@@maintenance-controlpanel"
+  <configlet title="Security" action_id="SecuritySettings"
+  appId="SecuritySettings" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/lock_icon.png"
+  url_expr="string:${portal_url}/@@security-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
   <configlet title="Content Rules" action_id="ContentRules"
   appId="Plone" category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/contentrules_icon.png"
+  icon_expr="string:${portal_url}/contentrules_icon.png"
   url_expr="string:${portal_url}/@@rules-controlpanel"
   visible="True">
     <permission>Content rules: Manage rules</permission>
   </configlet>
-  <configlet title="Visual editor" action_id="kupu" appId="Kupu"
-  category="Plone" condition_expr=""
-  icon_expr="string:$portal_url/kupuimages/kupu_icon.gif"
-  url_expr="string:${portal_url}/kupu_library_tool/kupu_config"
+  <configlet title="Types" action_id="TypesSettings"
+  appId="TypesSettings" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/document_icon.png"
+  url_expr="string:${portal_url}/@@types-controlpanel"
+  visible="True">
+    <permission>Manage portal</permission>
+  </configlet>
+  <configlet title="Language" action_id="PloneLanguageTool"
+  appId="PloneLanguageTool" category="Plone" condition_expr=""
+  icon_expr="string:${portal_url}/flag-plone.png"
+  url_expr="string:${portal_url}/@@language-controlpanel"
   visible="True">
     <permission>Manage portal</permission>
   </configlet>
diff -uiwBrN fresh_plone_40/cssregistry.xml migrated_from_25/cssregistry.xml
--- fresh_plone_40/cssregistry.xml	2009-09-06 00:24:27.000000000 +0200
+++ migrated_from_25/cssregistry.xml	2009-09-06 00:25:28.000000000 +0200
@@ -7,6 +7,26 @@
   id="member.css" media="screen" rel="stylesheet"
   rendering="import" />
   <stylesheet title="" cacheable="True" compression="safe"
+  cookable="True" enabled="1"
+  expression="python:portal.restrictedTraverse('@@plone_portal_state').is_rtl()"
+  id="RTL.css" media="screen" rel="stylesheet"
+  rendering="import" />
+  <stylesheet title="" cacheable="True" compression="safe"
+  cookable="True" enabled="True"
+  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
+  id="kupustyles.css" media="" rel="stylesheet"
+  rendering="import" />
+  <stylesheet title="" cacheable="True" compression="safe"
+  cookable="True" enabled="True"
+  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
+  id="kupuplone.css" media="" rel="stylesheet"
+  rendering="import" />
+  <stylesheet title="" cacheable="True" compression="safe"
+  cookable="True" enabled="True"
+  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
+  id="kupudrawerstyles.css" media="" rel="stylesheet"
+  rendering="import" />
+  <stylesheet title="" cacheable="True" compression="safe"
   cookable="True" enabled="1" expression="" id="base.css"
   media="screen" rel="stylesheet" rendering="import" />
   <stylesheet title="" cacheable="True" compression="safe"
@@ -46,24 +66,6 @@
   cookable="True" enabled="1" expression="" id="ploneKss.css"
   media="screen" rel="stylesheet" rendering="import" />
   <stylesheet title="" cacheable="True" compression="safe"
-  cookable="True" enabled="1"
-  expression="python:portal.restrictedTraverse('@@plone_portal_state').is_rtl()"
-  id="RTL.css" media="screen" rel="stylesheet"
-  rendering="import" />
-  <stylesheet title="" cacheable="True" compression="safe"
-  cookable="True" enabled="True"
-  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
-  id="kupustyles.css" media="" rel="stylesheet" rendering="link" />
-  <stylesheet title="" cacheable="True" compression="safe"
-  cookable="True" enabled="True"
-  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
-  id="kupuplone.css" media="" rel="stylesheet" rendering="link" />
-  <stylesheet title="" cacheable="True" compression="safe"
-  cookable="True" enabled="True"
-  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
-  id="kupudrawerstyles.css" media="" rel="stylesheet"
-  rendering="link" />
-  <stylesheet title="" cacheable="True" compression="safe"
   cookable="True" enabled="1" expression="" id="ploneCustom.css"
   media="all" rel="stylesheet" rendering="import" />
 </object>
diff -uiwBrN fresh_plone_40/import_steps.xml migrated_from_25/import_steps.xml
--- fresh_plone_40/import_steps.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/import_steps.xml	2009-09-06 00:25:28.000000000 +0200
@@ -32,8 +32,7 @@
   <import-step id="kupu-setup" version="20061211-01"
   handler="Products.kupu.plone.exportimport.importKupuSettings"
   title="Kupu Settings">
-  <dependency step="plone_various" />Import Kupu
-  settings</import-step>
+  <dependency step="toolset" />Import Kupu settings</import-step>
   <import-step id="languagetool" version="20070615-01"
   handler="Products.PloneLanguageTool.exportimport.importLanguageTool"
   title="Plone Language Tool">
@@ -49,7 +48,6 @@
   handler="Products.PlonePAS.setuphandlers.setupPlonePAS"
   title="PlonePAS setup">
   <dependency step="componentregistry" />
-  <dependency step="controlpanel" />
   <dependency step="memberdata-properties" />
   <dependency step="plonepas-contents" />
   <dependency step="rolemap" />PlonePAS installation
diff -uiwBrN fresh_plone_40/jsregistry.xml migrated_from_25/jsregistry.xml
--- fresh_plone_40/jsregistry.xml	2009-09-06 00:24:51.000000000 +0200
+++ migrated_from_25/jsregistry.xml	2009-09-06 00:25:28.000000000 +0200
@@ -4,13 +4,13 @@
   <javascript cacheable="True" compression="none" cookable="True"
   enabled="True" expression="" id="jquery.js" inline="False" />
   <javascript cacheable="True" compression="full-encode"
-  cookable="True" enabled="False" expression="" id="cssQuery.js"
+  cookable="True" enabled="True" expression="" id="cssQuery.js"
   inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
   enabled="True" expression="" id="jquery-integration.js"
   inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False" expression="" id="event-registration.js"
+  enabled="True" expression="" id="event-registration.js"
   inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
   enabled="True" expression="" id="register_function.js"
@@ -35,7 +35,7 @@
   enabled="True" expression="" id="dragdropreorder.js"
   inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False" expression="" id="mark_special_links.js"
+  enabled="True" expression="" id="mark_special_links.js"
   inline="False" />
   <javascript cacheable="True" compression="full" cookable="True"
   enabled="True" expression="" id="collapsiblesections.js"
@@ -76,7 +76,7 @@
   expression="not: portal/portal_membership/isAnonymousUser"
   id="calendar_formfield.js" inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False"
+  enabled="True"
   expression="not: portal/portal_membership/isAnonymousUser"
   id="calendarpopup.js" inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
@@ -92,32 +92,11 @@
   expression="not: portal/portal_membership/isAnonymousUser"
   id="unlockOnFormUnload.js" inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="True"
-  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request) or not context.restrictedTraverse('@@plone_portal_state').anonymous()"
-  id="sarissa.js" inline="False" />
-  <javascript cacheable="True" compression="none" cookable="True"
-  enabled="False" expression="" id="++resource++MochiKit.js"
-  inline="False" />
-  <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False" expression="" id="++resource++prototype.js"
-  inline="False" />
-  <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False" expression="" id="++resource++effects.js"
-  inline="False" />
+  enabled="True" expression="" id="ie5fixes.js" inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
-  enabled="False" expression="" id="++resource++cssQuery-compat.js"
-  inline="False" />
-  <javascript cacheable="True" compression="none" cookable="True"
-  enabled="True" expression="" id="++resource++base2-dom-fp.js"
-  inline="False" />
-  <javascript cacheable="True" compression="none" cookable="True"
   enabled="True"
-  expression="python: not context.restrictedTraverse('@@plone_portal_state').anonymous() and context.restrictedTraverse('@@kss_devel_mode').isoff()"
-  id="++resource++kukit.js" inline="False" />
-  <javascript cacheable="True" compression="none" cookable="True"
-  enabled="True"
-  expression="python: not context.restrictedTraverse('@@plone_portal_state').anonymous() and context.restrictedTraverse('@@kss_devel_mode').ison()"
-  id="++resource++kukit-devel.js" inline="False" />
+  expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request) or not here.restrictedTraverse('@@plone_portal_state').anonymous()"
+  id="sarissa.js" inline="False" />
   <javascript cacheable="True" compression="safe" cookable="True"
   enabled="True"
   expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
@@ -166,4 +145,27 @@
   enabled="True"
   expression="python:portal.kupu_library_tool.isKupuEnabled(REQUEST=request)"
   id="kupuploneinit.js" inline="False" />
+  <javascript cacheable="True" compression="none" cookable="True"
+  enabled="False" expression="" id="++resource++MochiKit.js"
+  inline="False" />
+  <javascript cacheable="True" compression="safe" cookable="True"
+  enabled="False" expression="" id="++resource++prototype.js"
+  inline="False" />
+  <javascript cacheable="True" compression="safe" cookable="True"
+  enabled="False" expression="" id="++resource++effects.js"
+  inline="False" />
+  <javascript cacheable="True" compression="safe" cookable="True"
+  enabled="False" expression="" id="++resource++cssQuery-compat.js"
+  inline="False" />
+  <javascript cacheable="True" compression="none" cookable="True"
+  enabled="True" expression="" id="++resource++base2-dom-fp.js"
+  inline="False" />
+  <javascript cacheable="True" compression="none" cookable="True"
+  enabled="True"
+  expression="python: not here.restrictedTraverse('@@plone_portal_state').anonymous() and here.restrictedTraverse('@@kss_devel_mode').isoff()"
+  id="++resource++kukit.js" inline="False" />
+  <javascript cacheable="True" compression="none" cookable="True"
+  enabled="True"
+  expression="python: not here.restrictedTraverse('@@plone_portal_state').anonymous() and here.restrictedTraverse('@@kss_devel_mode').ison()"
+  id="++resource++kukit-devel.js" inline="False" />
 </object>
diff -uiwBrN fresh_plone_40/kssregistry.xml migrated_from_25/kssregistry.xml
--- fresh_plone_40/kssregistry.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/kssregistry.xml	2009-09-06 00:25:28.000000000 +0200
@@ -2,10 +2,10 @@
 <object name="portal_kss" meta_type="KSS Registry"
 debugmode="True">
   <kineticstylesheet authenticated="False" cacheable="True"
-  compression="safe" cookable="True"
+  compression="none" conditionalcomment="" cookable="True"
   enabled="1" expression="" id="at.kss" />
   <kineticstylesheet authenticated="False" cacheable="True"
-  compression="safe" cookable="True"
+  compression="none" conditionalcomment="" cookable="True"
   enabled="1" expression="" id="plone.kss" />
   <kineticstylesheet authenticated="False" cacheable="True"
   compression="safe" conditionalcomment="" cookable="True"
diff -uiwBrN fresh_plone_40/kupu.xml migrated_from_25/kupu.xml
--- fresh_plone_40/kupu.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/kupu.xml	2009-09-06 00:25:28.000000000 +0200
@@ -2,11 +2,10 @@
 <kupu-settings>
   <config captioning="False" userefbrowser="False"
   linkbyuid="False" filtersourceedit="True">
-    <table>plain|Subdued grid</table>
-    <table>invisible|Invisible grid</table>
-    <table>listing|Fancy listing</table>
-    <table>grid listing|Fancy grid listing</table>
-    <table>vertical listing|Fancy vertical listing</table>
+    <table>plain</table>
+    <table>listing</table>
+    <table>vertical listing</table>
+    <table>listing nosort|unsorted listing</table>
     <style>Heading|h2</style>
     <style>Subheading|h3</style>
     <style>Literal|pre</style>
@@ -17,8 +16,6 @@
     <style>Odd row|tr|odd</style>
     <style>Even row|tr|even</style>
     <style>Heading cell|th|</style>
-    <style>Page break (print only)|div|pageBreak</style>
-    <style>Clear floats|div|visualClear</style>
     <filter attributes=""
     tags="center tt big small basefont font" />
     <filter attributes="lang valign halign border frame rules cellspacing cellpadding bgcolor"
@@ -28,15 +25,14 @@
     <filterstyle>list-style-type</filterstyle>
     <filterstyle>float</filterstyle>
   </config>
-  <library src="string:${globals_view/navigationRootUrl|portal_url}/kupucollection.xml"
-  uri="string:${globals_view/navigationRootUrl|portal_url}"
-  id="root"
-  icon="string:${globals_view/navigationRootUrl|portal_url}/misc_/CMFPlone/plone_icon"
+  <library src="string:${portal_url}/kupucollection.xml"
+  uri="string:${portal_url}" id="root"
+  icon="string:${portal_url}/misc_/CMFPlone/plone_icon"
   title="string:Home"></library>
   <library src="string:${folder_url}/kupucollection.xml"
   uri="string:${folder_url}" id="current"
-  icon="string:${folder/getIcon}" title="string:Current folder">
-  </library>
+  icon="string:${portal_url}/folder_icon.gif"
+  title="string:Current folder"></library>
   <library src="string:${portal_url}/kupumyitems.xml"
   uri="string:${portal_url}/kupumyitems.xml" id="myitems"
   icon="string:${portal_url}/kupuimages/kupusearch_icon.gif"
@@ -45,33 +41,11 @@
   uri="string:${portal_url}/kupurecentitems.xml" id="recentitems"
   icon="string:${portal_url}/kupuimages/kupusearch_icon.gif"
   title="string:Recent items"></library>
-  <defaultlibrary>current</defaultlibrary>
+  <defaultlibrary></defaultlibrary>
   <resource id="collection" mode="whitelist">
     <type>Plone Site</type>
-    <type>Large Plone Folder</type>
     <type>Folder</type>
-  </resource>
-  <resource id="containsanchors" mode="blacklist">
-    <type>ATBooleanCriterion</type>
-    <type>ATCurrentAuthorCriterion</type>
-    <type>ATDateCriteria</type>
-    <type>ATDateRangeCriterion</type>
-    <type>ATListCriterion</type>
-    <type>ATPathCriterion</type>
-    <type>ATPortalTypeCriterion</type>
-    <type>ATReferenceCriterion</type>
-    <type>ATSelectionCriterion</type>
-    <type>ATSimpleIntCriterion</type>
-    <type>ATSimpleStringCriterion</type>
-    <type>ATSortCriterion</type>
-    <type>Discussion Item</type>
-    <type>File</type>
-    <type>Folder</type>
-    <type>Image</type>
     <type>Large Plone Folder</type>
-    <type>Link</type>
-    <type>TempFolder</type>
-    <type>Topic</type>
   </resource>
   <resource id="linkable" mode="blacklist">
     <type>ATBooleanCriterion</type>
@@ -82,24 +56,33 @@
     <type>ATPathCriterion</type>
     <type>ATPortalTypeCriterion</type>
     <type>ATReferenceCriterion</type>
-    <type>ATRelativePathCriterion</type>
     <type>ATSelectionCriterion</type>
     <type>ATSimpleIntCriterion</type>
     <type>ATSimpleStringCriterion</type>
     <type>ATSortCriterion</type>
     <type>Discussion Item</type>
+    <type>Folder</type>
+    <type>Large Plone Folder</type>
     <type>Link</type>
     <type>Plone Site</type>
     <type>TempFolder</type>
+    <type>Topic</type>
   </resource>
   <resource id="mediaobject" mode="whitelist">
     <type>Image</type>
   </resource>
   <defaultresource>linkable</defaultresource>
-  <preview portaltype="Image" scalefield="image"
-  preview="string:${object_url}/image_thumb" />
-  <preview portaltype="News Item" scalefield="image"
-  preview="string:${object_url}/image_thumb" />
   <globaltoolbar></globaltoolbar>
   <toolbar>
     <element visible="True" id="save-button" />
diff -uiwBrN fresh_plone_40/portal_languages.xml migrated_from_25/portal_languages.xml
--- fresh_plone_40/portal_languages.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/portal_languages.xml	2009-09-06 00:25:28.000000000 +0200
@@ -2,7 +2,7 @@
 <object>
   <default_language value="en" />
   <use_path_negotiation value="False" />
-  <use_cookie_negotiation value="False" />
+  <use_cookie_negotiation value="True" />
   <use_request_negotiation value="False" />
   <use_cctld_negotiation value="False" />
   <use_content_negotiation value="False" />
diff -uiwBrN fresh_plone_40/portlets.xml migrated_from_25/portlets.xml
--- fresh_plone_40/portlets.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/portlets.xml	2009-09-06 00:25:28.000000000 +0200
@@ -81,8 +81,14 @@
     <property name="bottomLevel">0</property>
     <property name="root" />
   </assignment>
-  <assignment name="login" category="context" key="/"
+  <assignment name="label_log_in" category="context" key="/"
   manager="plone.leftcolumn" type="portlets.Login" />
   <assignment name="news" category="context" key="/"
   manager="plone.rightcolumn" type="portlets.News">
     <property name="count">5</property>
diff -uiwBrN fresh_plone_40/propertiestool.xml migrated_from_25/propertiestool.xml
--- fresh_plone_40/propertiestool.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/propertiestool.xml	2009-09-06 00:25:28.000000000 +0200
-    <property name="localTimeOnlyFormat" type="string">%I:%M
-    %p</property>
+    <property name="use_folder_tabs" type="lines">
+      <element value="Large Plone Folder" />
+      <element value="Folder" />
+      <element value="Plone Site" />
+    </property>
     <property name="default_page_types" type="lines">
+      <element value="Document" />
+      <element value="Event" />
+      <element value="Link" />
+      <element value="News Item" />
       <element value="Topic" />
     </property>
+    <property name="refwidget_startupdirectories" type="lines" />
     <property name="forbidden_contenttypes" type="lines">
-      <element value="text/x-html-captioned" />
     </property>
-    <property name="enable_inline_editing" type="boolean">
-    False</property>
+    <property name="enable_inline_editing" type="boolean">
+    True</property>
-    <property name="webstats_js" type="text"></property>
+    <property name="webstats_js" type="string"></property>
-    <property name="mark_special_links" type="string">
-    false</property>
+    <property name="disable_nonfolderish_sections" type="boolean">
+    True</property>
-    <property name="disable_nonfolderish_sections" type="boolean">
-    False</property>
   </object>
 </object>
diff -uiwBrN fresh_plone_40/rolemap.xml migrated_from_25/rolemap.xml
--- fresh_plone_40/rolemap.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/rolemap.xml	2009-09-06 00:25:28.000000000 +0200
@@ -15,49 +15,36 @@
     <permission name="ATContentTypes: Add Document" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add Event" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add File" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add Folder" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add Image" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add Large Plone Folder"
     acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add Link" acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="ATContentTypes: Add News Item"
     acquire="True">
       <role name="Contributor" />
       <role name="Manager" />
-      <role name="Owner" />
-    </permission>
-    <permission name="Access contents information" acquire="True">
-      <role name="Contributor" />
-      <role name="Editor" />
-      <role name="Reader" />
     </permission>
     <permission name="Access inactive portal content"
     acquire="True">
@@ -120,9 +107,6 @@
       <role name="Owner" />
       <role name="Reviewer" />
     </permission>
-    <permission name="Content rules: Manage rules" acquire="False">
-      <role name="Manager" />
-    </permission>
     <permission name="Delete objects" acquire="True">
       <role name="Editor" />
       <role name="Manager" />
@@ -133,12 +117,8 @@
       <role name="Owner" />
     </permission>
     <permission name="List folder contents" acquire="True">
-      <role name="Contributor" />
-      <role name="Editor" />
       <role name="Manager" />
-      <role name="Member" />
       <role name="Owner" />
-      <role name="Reader" />
     </permission>
     <permission name="List portal members" acquire="True">
       <role name="Manager" />
@@ -160,15 +140,6 @@
     <permission name="Modify view template" acquire="True">
       <role name="Editor" />
       <role name="Manager" />
-      <role name="Owner" />
-    </permission>
-    <permission name="Portlets: Manage own portlets"
-    acquire="True">
-      <role name="Manager" />
-      <role name="Member" />
-    </permission>
-    <permission name="Portlets: Manage portlets" acquire="True">
-      <role name="Manager" />
     </permission>
     <permission name="Reply to item" acquire="True">
       <role name="Manager" />
@@ -177,7 +148,6 @@
     <permission name="Request review" acquire="True">
       <role name="Editor" />
       <role name="Manager" />
-      <role name="Owner" />
     </permission>
     <permission name="Review portal content" acquire="True">
       <role name="Manager" />
@@ -200,8 +170,7 @@
       <role name="Manager" />
     </permission>
     <permission name="View" acquire="True">
-      <role name="Contributor" />
-      <role name="Editor" />
+      <role name="Manager" />
       <role name="Reader" />
     </permission>
     <permission name="View Groups" acquire="True">
diff -uiwBrN fresh_plone_40/skins.xml migrated_from_25/skins.xml
--- fresh_plone_40/skins.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/skins.xml	2009-09-06 00:25:28.000000000 +0200
@@ -18,6 +18,9 @@
   <object name="PasswordReset"
   meta_type="Filesystem Directory View"
   directory="Products.PasswordResetTool:skins/PasswordReset" />
+  <object name="ResourceRegistries"
+  meta_type="Filesystem Directory View"
+  directory="ResourceRegistries/skins/ResourceRegistries" />
   <object name="archetypes" meta_type="Filesystem Directory View"
   directory="Products.Archetypes:skins/archetypes" />
   <object name="archetypes_kss"
@@ -29,13 +32,15 @@
   meta_type="Filesystem Directory View"
   directory="Products.CMFEditions:skins/cmfeditions_views" />
   <object name="custom" meta_type="Folder" />
+  <object name="gruf" meta_type="Filesystem Directory View"
+  directory="GroupUserFolder/skins/gruf" />
+  <object name="gruf_plone_2_0"
+  meta_type="Filesystem Directory View"
+  directory="GroupUserFolder/skins/gruf_plone_2_0" />
   <object name="kupu" meta_type="Filesystem Directory View"
   directory="Products.kupu:common" />
   <object name="kupu_plone" meta_type="Filesystem Directory View"
   directory="Products.kupu:plone/kupu_plone_layer" />
-  <object name="kupu_references"
-  meta_type="Filesystem Directory View"
-  directory="Products.kupu:plone/kupu_references" />
   <object name="kupu_tests" meta_type="Filesystem Directory View"
   directory="Products.kupu:tests" />
   <object name="mimetypes_icons"
@@ -64,6 +69,9 @@
   directory="Products.CMFPlone:skins/plone_kss" />
   <object name="plone_login" meta_type="Filesystem Directory View"
   directory="Products.CMFPlone:skins/plone_login" />
+  <object name="plone_portlets"
+  meta_type="Filesystem Directory View"
+  directory="CMFPlone/skins/plone_portlets" />
   <object name="plone_prefs" meta_type="Filesystem Directory View"
   directory="Products.CMFPlone:skins/plone_prefs" />
   <object name="plone_scripts"
@@ -71,6 +79,9 @@
   directory="Products.CMFPlone:skins/plone_scripts" />
   <object name="plone_styles" meta_type="Filesystem Directory View"
   directory="Products.CMFPlone:skins/plone_styles" />
+  <object name="plone_tableless"
+  meta_type="Filesystem Directory View"
+  directory="CMFPlone/skins/plone_tableless" />
   <object name="plone_templates"
   meta_type="Filesystem Directory View"
   directory="Products.CMFPlone:skins/plone_templates" />
@@ -83,19 +94,20 @@
+    <layer name="ResourceRegistries" />
+    <layer name="gruf" />
+    <layer name="plone_portlets" />
   </skin-path>
 </object>
diff -uiwBrN fresh_plone_40/toolset.xml migrated_from_25/toolset.xml
--- fresh_plone_40/toolset.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/toolset.xml	2009-09-06 00:25:28.000000000 +0200
@@ -2,18 +2,12 @@
 <tool-setup>
   <required tool_id="MailHost"
   class="Products.SecureMailHost.SecureMailHost.SecureMailHost" />
-  <required tool_id="archetype_tool"
-  class="Products.Archetypes.ArchetypeTool" />
   <required tool_id="caching_policy_manager"
   class="Products.CMFCore.CachingPolicyManager.CachingPolicyManager" />
   <required tool_id="content_type_registry"
   class="Products.CMFCore.ContentTypeRegistry.ContentTypeRegistry" />
   <required tool_id="error_log"
   class="Products.SiteErrorLog.SiteErrorLog.SiteErrorLog" />
-  <required tool_id="kupu_library_tool"
-  class="Products.kupu.plone.plonelibrarytool.PloneKupuLibraryTool" />
-  <required tool_id="mimetypes_registry"
-  class="Products.MimetypesRegistry.MimeTypesRegistry.MimeTypesRegistry" />
   <required tool_id="plone_utils"
   class="Products.CMFPlone.PloneTool.PloneTool" />
   <required tool_id="portal_actionicons"
@@ -38,8 +32,6 @@
   class="Products.CMFPlone.DiscussionTool.DiscussionTool" />
   <required tool_id="portal_factory"
   class="Products.CMFPlone.FactoryTool.FactoryTool" />
-  <required tool_id="portal_form_controller"
-  class="Products.CMFFormController.FormController.FormController" />
   <required tool_id="portal_groupdata"
   class="Products.PlonePAS.tools.groupdata.GroupDataTool" />
   <required tool_id="portal_groups"
@@ -66,8 +58,6 @@
   class="Products.CMFPlone.MigrationTool.MigrationTool" />
   <required tool_id="portal_modifier"
   class="Products.CMFEditions.ModifierRegistryTool.ModifierRegistryTool" />
-  <required tool_id="portal_password_reset"
-  class="Products.PasswordResetTool.PasswordResetTool.PasswordResetTool" />
   <required tool_id="portal_placeful_workflow"
   class="Products.CMFPlacefulWorkflow.PlacefulWorkflowTool.PlacefulWorkflowTool" />
   <required tool_id="portal_properties"
@@ -86,8 +76,6 @@
   class="Products.CMFPlone.SkinsTool.SkinsTool" />
   <required tool_id="portal_syndication"
   class="Products.CMFPlone.SyndicationTool.SyndicationTool" />
-  <required tool_id="portal_transforms"
-  class="Products.PortalTransforms.TransformEngine.TransformTool" />
   <required tool_id="portal_types"
   class="Products.CMFPlone.TypesTool.TypesTool" />
   <required tool_id="portal_uidannotation"
@@ -104,10 +92,6 @@
   class="plone.app.customerize.tool.ViewTemplateContainer" />
   <required tool_id="portal_workflow"
   class="Products.CMFPlone.WorkflowTool.WorkflowTool" />
-  <required tool_id="reference_catalog"
-  class="Products.Archetypes.ReferenceEngine.ReferenceCatalog" />
   <required tool_id="translation_service"
   class="Products.CMFPlone.TranslationServiceTool.TranslationServiceTool" />
-  <required tool_id="uid_catalog"
-  class="Products.Archetypes.UIDCatalog.UIDCatalog" />
 </tool-setup>
diff -uiwBrN fresh_plone_40/types/ATRelativePathCriterion.xml migrated_from_25/types/ATRelativePathCriterion.xml
--- fresh_plone_40/types/ATRelativePathCriterion.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/ATRelativePathCriterion.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,47 +0,0 @@
-<?xml version="1.0"?>
-<object name="ATRelativePathCriterion"
-meta_type="Factory-based Type Information" i18n:domain="plone"
-xmlns:i18n="http://xml.zope.org/namespaces/i18n">
-  <property name="title" i18n:translate="">Relative Path
-  Criterion</property>
-  <property name="description" i18n:translate="">A relative path
-  criterion</property>
-  <property name="content_icon">document_icon.png</property>
-  <property name="icon_expr">
-  string:${portal_url}/document_icon.png</property>
-  <property name="content_meta_type">
-  ATRelativePathCriterion</property>
-  <property name="product">ATContentTypes</property>
-  <property name="factory">addATRelativePathCriterion</property>
-  <property name="add_view_expr"></property>
-  <property name="link_target"></property>
-  <property name="immediate_view">base_edit</property>
-  <property name="global_allow">False</property>
-  <property name="filter_content_types">False</property>
-  <property name="allowed_content_types" />
-  <property name="allow_discussion">False</property>
-  <alias from="edit" to="base_edit" />
-  <action title="View" action_id="view" category="object"
-  condition_expr="" icon_expr="" link_target=""
-  url_expr="string:${object_url}/base_view" visible="True">
-    <permission value="View" />
-  </action>
-  <action title="Edit" action_id="edit" category="object"
-  condition_expr="" icon_expr="" link_target=""
-  url_expr="string:${object_url}/base_edit" visible="True">
-    <permission value="Modify portal content" />
-  </action>
-  <action title="Properties" action_id="metadata" category="object"
-  condition_expr="" icon_expr="" link_target=""
-  url_expr="string:${object_url}/base_metadata" visible="False">
-    <permission value="Modify portal content" />
-  </action>
-  <action title="References" action_id="references"
-  category="object"
-  condition_expr="object/archetype_tool/has_graphviz" icon_expr=""
-  link_target="" url_expr="string:${object_url}/reference_graph"
-  visible="False">
-    <permission value="Modify portal content" />
-    <permission value="Review portal content" />
-  </action>
-</object>
diff -uiwBrN fresh_plone_40/types/Discussion_Item.xml migrated_from_25/types/Discussion_Item.xml
--- fresh_plone_40/types/Discussion_Item.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Discussion_Item.xml	2009-09-06 00:05:57.000000000 +0200
@@ -28,6 +28,14 @@
   visible="True">
     <permission value="View" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
   <action title="External Edit" action_id="external_edit"
   category="object" condition_expr="" icon_expr="" link_target=""
   url_expr="string:$object_url/external_edit" visible="False">
diff -uiwBrN fresh_plone_40/types/Document.xml migrated_from_25/types/Document.xml
--- fresh_plone_40/types/Document.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Document.xml	2009-09-06 00:05:57.000000000 +0200
@@ -26,6 +26,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -58,4 +60,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Event.xml migrated_from_25/types/Event.xml
--- fresh_plone_40/types/Event.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Event.xml	2009-09-06 00:05:57.000000000 +0200
@@ -27,6 +27,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -71,4 +73,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/File.xml migrated_from_25/types/File.xml
--- fresh_plone_40/types/File.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/File.xml	2009-09-06 00:05:57.000000000 +0200
@@ -26,6 +26,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="index_html" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -58,4 +60,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Folder.xml migrated_from_25/types/Folder.xml
--- fresh_plone_40/types/Folder.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Folder.xml	2009-09-06 00:05:57.000000000 +0200
@@ -29,6 +29,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -56,4 +58,17 @@
   visible="False">
     <permission value="View" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
+  <action title="External Edit" action_id="external_edit"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:$object_url/external_edit" visible="False">
+    <permission value="Modify portal content" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Image.xml migrated_from_25/types/Image.xml
--- fresh_plone_40/types/Image.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Image.xml	2009-09-06 00:05:57.000000000 +0200
@@ -27,6 +27,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="index_html" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -65,4 +67,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Large_Plone_Folder.xml migrated_from_25/types/Large_Plone_Folder.xml
--- fresh_plone_40/types/Large_Plone_Folder.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Large_Plone_Folder.xml	2009-09-06 00:05:57.000000000 +0200
@@ -29,6 +29,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -56,4 +58,17 @@
   visible="False">
     <permission value="View" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
+  <action title="External Edit" action_id="external_edit"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:$object_url/external_edit" visible="False">
+    <permission value="Modify portal content" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Link.xml migrated_from_25/types/Link.xml
--- fresh_plone_40/types/Link.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Link.xml	2009-09-06 00:05:57.000000000 +0200
@@ -26,6 +26,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -53,4 +55,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/News_Item.xml migrated_from_25/types/News_Item.xml
--- fresh_plone_40/types/News_Item.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/News_Item.xml	2009-09-06 00:05:57.000000000 +0200
@@ -27,6 +27,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -59,4 +61,12 @@
   url_expr="string:${object_url}/external_edit" visible="False">
     <permission value="Modify portal content" />
   </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Plone_Site.xml migrated_from_25/types/Plone_Site.xml
--- fresh_plone_40/types/Plone_Site.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Plone_Site.xml	2009-09-06 00:05:57.000000000 +0200
@@ -29,6 +29,7 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="folder_edit_form" />
+  <alias from="index.html" to="(dynamic view)" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
diff -uiwBrN fresh_plone_40/types/TempFolder.xml migrated_from_25/types/TempFolder.xml
--- fresh_plone_40/types/TempFolder.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/TempFolder.xml	2009-09-06 00:05:57.000000000 +0200
@@ -31,6 +32,7 @@
   </property>
   <property name="allow_discussion">False</property>
   <alias from="(Default)" to="index_html" />
+  <alias from="index.html" to="index_html" />
   <alias from="view" to="index_html" />
   <action title="View" action_id="view" category="object"
   condition_expr="" icon_expr="" link_target=""
@@ -52,4 +54,28 @@
   url_expr="string:${object_url}/folder_contents" visible="True">
     <permission value="List folder contents" />
   </action>
+  <action title="New..." action_id="new" category="object"
+  condition_expr="" icon_expr="" link_target=""
+  url_expr="string:${object_url}/folder_factories" visible="False">
+    <permission value="Add portal content" />
+  </action>
+  <action title="Rename items" action_id="rename_items"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:${object_url}/folder_rename_form"
+  visible="False">
+    <permission value="Add portal content" />
+  </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
+  <action title="External Edit" action_id="external_edit"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:$object_url/external_edit" visible="False">
+    <permission value="Modify portal content" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types/Topic.xml migrated_from_25/types/Topic.xml
--- fresh_plone_40/types/Topic.xml	2009-09-06 00:04:58.000000000 +0200
+++ migrated_from_25/types/Topic.xml	2009-09-06 00:05:57.000000000 +0200
@@ -33,6 +33,8 @@
   <property name="default_view_fallback">False</property>
   <alias from="(Default)" to="(dynamic view)" />
   <alias from="edit" to="atct_edit" />
+  <alias from="index.html" to="(dynamic view)" />
+  <alias from="properties" to="base_metadata" />
   <alias from="sharing" to="@@sharing" />
   <alias from="view" to="(selected layout)" />
   <action title="View" action_id="view" category="object"
@@ -54,6 +56,12 @@
     <permission value="Modify portal content" />
     <permission value="Review portal content" />
   </action>
+  <action title="Folder Listing" action_id="folderlisting"
+  category="folder" condition_expr="object/isPrincipiaFolderish"
+  icon_expr="" link_target="" url_expr="string:${folder_url}/view"
+  visible="False">
+    <permission value="View" />
+  </action>
   <action title="Criteria" action_id="criteria" category="object"
   condition_expr="" icon_expr="" link_target=""
   url_expr="string:${folder_url}/criterion_edit_form"
@@ -66,4 +74,33 @@
   visible="True">
     <permission value="Change portal topics" />
   </action>
+  <action title="Subtopics" action_id="folderContents"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:${object_url}/folder_contents" visible="True">
+    <permission value="List folder contents" />
+  </action>
+  <action title="New..." action_id="new" category="object"
+  condition_expr="" icon_expr="" link_target=""
+  url_expr="string:${object_url}/folder_factories" visible="False">
+    <permission value="Add portal topics" />
+  </action>
+  <action title="Rename items" action_id="rename_items"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:${object_url}/folder_rename_form"
+  visible="False">
+    <permission value="Add portal topics" />
+  </action>
+  <action title="State" action_id="content_status_history"
+  category="object_tabs"
+  condition_expr="python:object and portal.portal_workflow.getTransitionsFor(object, object.getParentNode())"
+  icon_expr="" link_target=""
+  url_expr="string:$object_url/content_status_history"
+  visible="False">
+    <permission value="View" />
+  </action>
+  <action title="External Edit" action_id="external_edit"
+  category="object" condition_expr="" icon_expr="" link_target=""
+  url_expr="string:$object_url/external_edit" visible="False">
+    <permission value="Modify portal content" />
+  </action>
 </object>
diff -uiwBrN fresh_plone_40/types.xml migrated_from_25/types.xml
--- fresh_plone_40/types.xml	2009-09-06 00:03:53.000000000 +0200
+++ migrated_from_25/types.xml	2009-09-06 00:25:28.000000000 +0200
@@ -18,8 +18,6 @@
   meta_type="Factory-based Type Information" />
   <object name="ATReferenceCriterion"
   meta_type="Factory-based Type Information" />
-  <object name="ATRelativePathCriterion"
-  meta_type="Factory-based Type Information" />
   <object name="ATSelectionCriterion"
   meta_type="Factory-based Type Information" />
   <object name="ATSimpleIntCriterion"
