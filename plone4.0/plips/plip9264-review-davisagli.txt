PLIP 9264: Merge backport patches from plone.app.dexterity into Plone
=====================================================================

PLIP ticket: http://dev.plone.org/plone/ticket/9264

Review #1 by David Glick (dglick@gmail.com, davisagli on irc)

The PLIP was reviewed on Mac OS X 10.5.8 using python 2.6 and Firefox 3.5.2.


Review steps
------------

- Run buildout using the plip9264-cmf-addviews.cfg file.

- Visual review of the code changes in plone.app.content and
  plone.app.contentmenu

- Run bin/alltests

- Compare request/second as reported by
  ab -n100 -A admin:admin http://localhost:8080/test
  (logged in homepage) with and without this PLIP.


Notes and observations
----------------------

* The changes are minimal and look reasonable.

* Running tests for all packages results in no additional test failures
  compared to the Plone 4 base.

* My quick ab benchmark yielded 4.78 req/sec. with the PLIP buildout, vs. 5.27
  req/sec. with the Plone 4 base (12% slower with this PLIP).  I guess this is
  from looking up the folder/add actions?  Is there any way we can recoup this
  loss of performance?

* IMHO, support for IAdding should indeed be deprecated, and emit a warning if
  used (including a link to where to find info on what to do instead), but not
  removed until Plone 5.

* The plone.app.content.browser.folderfactories._allowedTypes method appears to
  be no longer used by plone.app.content, but is still used by
  plone.app.contentmenu and Products.CMFPlone.browser.ploneview.  Should this
  be deprecated and moved elsewhere?

* I imagine it would be helpful for the documentation team to include a summary
  of the various possible ways of registering a factory view, and which one
  is recommended.  Identifying particular documents that need to be updated
  would also be helpful.

Conclusion
----------

This is a desirable change (the existing ways of specifying an add view are too
arcane), and I wish I could vote a solid +1 on it.  However, the apparent
performance penalty means I can only give it +0.


Update, 9/24/09
===============

The performance concerns seem to have been addressed adequately.  My FWT vote is
now +1 for merging.  Since the IAdding support is being removed outright, a
deprecation warning should be added in Plone 3 when this is merged, per our
deprecation policy.
