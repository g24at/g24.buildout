PLIP 9256: Add Content Rules Mail Action Variables
==================================================

This plip is ready for merge.

Plip ticket: https://dev.plone.org/plone/ticket/9256


Changes since review
--------------------

(Thanks, David and Martin!)

  - Added table of substitutions to content rules management interface.
    This is dynamically generated, so any adapters added in products
    or enhancements of plone.stringinterp will automatically be included.
    
  - Added several substitutions for manager, reviewer and owner role e-mails.
  
  - Created a set of substitutions for information from the last change,
    whether version or workflow.
    
  - Switched to using the string.Template for the interpolation (thanks, ldr,
    for the suggestion).
    
  - Wrapped contentrules use of secureSend in a try: ... except MailHostError: ...
    block that logs the error rather than creating a site error.
    
  - Wrapped substitutions in try: ... except Unauthorized: ... to prevent
    site errors.


Summary of changes
------------------

  - Created plone.stringinterp, a simple ${id}-style string interpolation
    adapter that looks up variables via named adapters for the context.
    Named IStringSubstitution adapters are included for Dublin Core and
    some IVersionable variables.
    
    This package has only CMF dependencies, and might be useful outside
    Plone.
    
  - Modified the plone.app.contentrules to use an IStringInterpolator on
    the object associated with events to do the string interpolation.
    
  - Added to plone.app.contentrules a dependency on plone.stringinterp.

To-Do
-----

  It would be great to add a diff variable.

Summary of changes *not* made
-----------------------------

  Mentioned in the PLIP was the possibility of integrating 
  collective.contentrules.mail, which has some additional variable
  substitutions and allows for multiple "model" mail texts and for
  text or HTML email. I've obtained permissions to transfer it to
  the foundation, but decided not to integrate it at this time.
  
  Why? collective.contentrules.mail does not actually have a mechanism
  for adding or modifying variable substitutions, and I wanted to tackle
  that first. Integrating the "model" feature set would be a good PLIP
  for 4.1.


Needed documentation changes
----------------------------

  I'm surprised to say that there isn't any plone.org/documentation content
  describing use of string interpolation in content rules. There should be,
  and it should document all the preset variable names.

Backwards compatibility
-----------------------

  No issues


Credits
-------

  Steve McMahon
