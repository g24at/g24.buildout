PLIP 8801: Move action icon support into actions, deprecate CMFActionIcons
==========================================================================

This plip is ready for review.

Plip ticket: https://dev.plone.org/plone/ticket/8801


Branches
--------

This work was completed on the main Plone 4.0 branches alongside my other work
on the base of Plone 4.  In particular see:

http://dev.plone.org/plone/browser/Plone/branches/4.0
  revisions 20191, 20193, 28658, 28666
http://dev.plone.org/plone/browser/plone.app.upgrade/branches/1.0
  revision 28660


Summary of changes
------------------

- Plone's own action icons are now set on the action itself, via the icon_expr
  setting, rather than in the portal_actionicons tool.

- The getIconFor method of the Plone tool, which is used in various templates
  for retrieving icons, was modified to look for an icon on the action itself
  before falling back to the actionicons tool.

- A migration was added to set icon expressions on actions (using icon_expr) based
  on the existing persistent icon registrations in the actionicons tool. This
  migration is only done for icons corresponding to actions known to be
  associated with Plone core.

- Added support for using icon_expr with actions of the control panel tool.

- Deprecation warnings were added for when icons are added to, modified, or
  retrieved from the actionicons tool (either programmatically or via
  GenericSetup).


To do
-----


Tests
-----

Existing tests across our suite of products are showing no remaining failures
that I've identified as being related to the work on this PLIP.

A couple of tests for the migration were added to plone.app.upgrade.


Needed documentation changes
----------------------------

Any references to the action icons tool (portal_actionicons) or GS handler
(actionicons.xml) should be updated to make it clear that those approaches
are now deprecated, and give examples of registering icons using icon_expr
instead.

plone.org documentation appears to contain a single reference to actionicons,
at the bottom of http://plone.org/documentation/how-to/adding-configuration-settings-using-zope-3-schemas-and-formlib/
This should probably be fleshed out to include a full example of how to register a configlet including the new way of registering icons...or http://plone.org/documentation/how-to/configure-configlets/ could be merged or referenced -- but it needs to be updated to reflect modern practice.


i18n
----

I don't think these changes affect any publicly visible strings.


Backwards compatibility
-----------------------

Products still using the action icons tool or GS handler will still get
their icons registered as expected, but a deprecation warning will be
emitted.  It is anticipated that the action icons tool may be fully
removed in Plone 5.

We have two packages (kupu and iterate) whose Plone 3-compatible releases
also seem usable for Plone 4 so far.  These packages have been adjusted
to register their configlet icon in both the old and new ways.  In Plone
3 the icon_expr setting in controlpanel.xml will be ignored, and in Plone
4 the icon_expr will be found before the icon in the action icons tool.


Credits
-------

David Glick
Hanno Schlichting
