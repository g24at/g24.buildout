PLIP 9263: Merge backport patches from plone.app.dexterity into Plone
=====================================================================

This plip is in progress.

PLIP ticket: https://dev.plone.org/plone/ticket/9264

To do
-----

- more testing

Update 2009-09-09
-----------------

* Removed the magic "IAdding" check from Plone 3.3. It's easily replicated
  (see documentation changes below), but removing the check gives a
  performance boost that hopefully makes up for the cost of the extra
  action lookup.

Summary of changes
------------------

CMF 2.2 includes an action in the 'folder/add' category, constructed from the
property 'add_view_expr', which is now available on all FTIs. This should be
used to give a URL for an add view.

This PLIP merges patches from plone.app.dexterity into plone.app.content
(FolderFactoriesView) and plone.app.contentmenu (FactoriesSubMenuItem) to
support this property.


Needed documentation changes
----------------------------

We should make it clear that this property exists and is used by Plone. It
is already used by Dexterity, in conjunction with the ++add++ traversal
namespace.

The pattern of registering a view for IAdding (aka the '+' view) with the same
name as the 'factory' property in the FTI no longer works implicitly. If a
third party type has this, the add_view_expr property in the FTI should be
set to e.g.::

    string:${folder_url}/+/my.factory

Backwards compatibility
-----------------------

The add menu now constructs a URL for a type using the following rules:

 * If an add_view_expr is set, use that
 * Otherwise, fall back on a URL using createObject
 
See note above about changes required to the FTI configuration of any type
that uses an add form that is a view registered for the IAdding (+) view.
 
Credits
-------

Martin Aspeli
